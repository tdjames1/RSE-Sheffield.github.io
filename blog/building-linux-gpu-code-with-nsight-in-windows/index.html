<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://rse.shef.ac.uk/blog/building-linux-gpu-code-with-nsight-in-windows/">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Building Linux GPU Code with NSIGHT in Windows | RSE at Sheffield</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://rse.shef.ac.uk/blog/building-linux-gpu-code-with-nsight-in-windows/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Paul Richmond">
<link rel="prev" href="../spark-scala-sheffield-hpc/" title="Spark and Scala on Sheffield HPC systems" type="text/html">
<link rel="next" href="../coffee-and-cakes-event-2nd/" title="Coffee and Cakes Event" type="text/html">
<meta property="og:site_name" content="RSE at Sheffield">
<meta property="og:title" content="Building Linux GPU Code with NSIGHT in Windows">
<meta property="og:url" content="http://rse.shef.ac.uk/blog/building-linux-gpu-code-with-nsight-in-windows/">
<meta property="og:description" content="Why would you possibly want to build and execute CUDA GPU applications within NSight Eclipse for Linux within Microsoft Windows? Well if you use windows as your main OS there are plenty of reasons but">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-08T16:03:00Z">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://rse.shef.ac.uk/">

                <span id="blog-title">RSE at Sheffield</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../activities">What we do</a>
                </li>
<li>
<a href="../../training">Training</a>
                </li>
<li>
<a href="../../blog">Blog</a>
                </li>
<li>
<a href="../../community">Community</a>
                </li>
<li>
<a href="../../resources">Resources</a>
                </li>
<li>
<a href="../../forged">Forged in Sheffield</a>
                </li>
<li>
<a href="../../testimonials">Testimonials</a>
                </li>
<li>
<a href="../../contact">Contact Us</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Building Linux GPU Code with NSIGHT in Windows</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    <a href="../../authors/paul-richmond/">Paul Richmond</a>
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-05-08T16:03:00Z" itemprop="datePublished" title="2017-05-08 16:03">2017-05-08 16:03</time></a></p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Why would you possibly want to build and execute CUDA GPU applications within NSight Eclipse for Linux within Microsoft Windows? Well if you use windows as your main OS there are plenty of reasons but the most obvious is that you may be developing cross platform code and want to build and test it without dual booting. If you are thinking about virtual machines then forget about it. Most (except some very expensive enterprise options) do not have the ability to access a GPU device (e.g GPU pass-through) from within a virtual machine. </p>
<p>The purpose of this post is to describe how to install the necessary tools to permit local GPU development inside the Linux NSight IDE from within Windows. The advantages of which are not only cross platform development but also the ability to locally develop in powerful Linux IDE with remote execution and graphical debugging. This is particularly helpful if you want to execute or debug your code on a HPC system (like Sheffield's ShARC system) from Windows. The post focuses on the use of the new Windows 10 Linux subsystem, however you could use the approach to install CUDA tools on a lightweight Linux virtual machine. The concept is the same either way. i.e. build and debug locally execute remotely.</p>
<h3>Configuring the Linux Windows Subsystem for CUDA compilation</h3>
<p>The Windows 10 subsystem for Linux is available in the anniversary update. You can install it from the "Turn on or off windows features" dialogue. It is listed under "Windows subsystem for Linux (beta)". This alone is not enough to build our GPU applications as we will need to install CUDA. A normal CUDA install will require a local GPU and the installation of a CUDA compatible graphics driver. Fire up the Windows Bash Shell (or a Linux virtual machine). You can then use the following commands to install the CUDA toolkit without installing a graphics driver. This will install the core NVIDIA CUDA compiler (nvcc) and NSight. You can update the <code>CUDA_REPO_PKG</code> variable to install a different CUDA version.</p>
<pre class="code literal-block"><span class="x">sudo apt-get update</span>
<span class="x">CUDA_REPO_PKG=cuda-repo-ubuntu1404_8.0.44-1_amd64.deb</span>
<span class="x">wget http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86_64/</span><span class="p">$</span><span class="nv">CUDA_REPO_PKG</span><span class="x"></span>
<span class="x">sudo dpkg -i </span><span class="p">$</span><span class="nv">CUDA_REPO_PKG</span><span class="x"></span>
<span class="x">sudo apt-get update</span>
<span class="x">sudo apt-get install -y --no-install-recommends cuda-core-8-0 cuda-cudart-dev-8-0 nsight</span>
</pre>


<p>You can now create a symbolic link to a generic CUDA install. This will permit the addition and fast swapping of different CUDA versions.</p>
<pre class="code literal-block"><span class="x">sudo ln -s /usr/local/cuda-8.0 /usr/local/cuda </span>
<span class="x">export PATH=</span><span class="p">$</span><span class="nv">PATH</span><span class="x">:/usr/local/cuda/bin</span>
</pre>


<p>Note: if you want the CUDA bin location to be persistently on the PATH (after you reboot the Bash shell) then you will need to add the <code>export PATH</code> line to your .bashrc profile. Test that the install was successful by running nvcc.</p>
<pre class="code literal-block">nvcc --version
</pre>


<p>This should give you some information on the nvcc version. e.g. </p>
<pre class="code literal-block"><span class="n">nvcc</span><span class="o">:</span> <span class="n">NVIDIA</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="n">Cuda</span> <span class="n">compiler</span> <span class="n">driver</span>
<span class="n">Copyright</span> <span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="mi">2005</span><span class="o">-</span><span class="mi">2016</span> <span class="n">NVIDIA</span> <span class="n">Corporation</span>
<span class="n">Built</span> <span class="n">on</span> <span class="n">Tue_Jan_10_13</span><span class="o">:</span><span class="mi">22</span><span class="o">:</span><span class="mi">03</span><span class="n">_CST_2017</span>
<span class="n">Cuda</span> <span class="n">compilation</span> <span class="n">tools</span><span class="o">,</span> <span class="n">release</span> <span class="mf">8.0</span><span class="o">,</span> <span class="n">V8</span><span class="o">.</span><span class="mf">0.61</span>
</pre>


<p>The CUDA toolkit is now installed so you can build (but not execute) CUDA GPU programs using the Linux bash shell.</p>
<h3>Graphical editing with Nsight IDE</h3>
<p>To be able to run a graphical NSight IDE from within the Windows subsystem for Linux you will need to be running a X server within Windows. You can install the <strong>free</strong> <a href="https://sourceforge.net/projects/xming/">XMing</a> application for this purpose. If you would rather use a Linux virtual machine then you can avoid this step as the virtual machine will most likely have an X server included. The advantage of the Windows subsystem approach is that it is very lightweight. From within your Bash terminal you will need to set the following environment variable.</p>
<pre class="code literal-block">export DISPLAY=:0
</pre>


<p>The display variable is an environment variable passed to graphical applications. In this case, the value of <code>:0</code> it tells the application to use the first display on the local system (our XMing server in this case). If you want to make this environment variable change permanent then you should add it to your .bashrc profile. You can now run the NSight application from Bash.</p>
<pre class="code literal-block">nsight
</pre>


<p>Glorious isn't it. Within NSight we can create a new CUDA project which will compile using the local CUDA install. In order to remotely execute and debug you can use the "C++ Remote application" run configuration. This will require SSH access to a suitable Linux machine with a GPU and CUDA installed.</p>
<p>Future blog posts will cover how remote execution and debugging can be achieved on the University of Sheffield ShARC system. ShARC has a typical of job based HPC system which encourages job submission rather than execution of code on worker nodes via SSH logins. </p>
<h3>Summary of Bash Profile Changes</h3>
<p>I added the following to my .bashrc profile (located in the home directory) to ensure that NSight could be launched straight after starting the Bash shell in Windows.</p>
<pre class="code literal-block"><span class="err">#</span><span class="x"> add cuda bin dir to path</span>
<span class="x">export PATH=</span><span class="p">$</span><span class="nv">PATH</span><span class="x">:/usr/local/cuda/bin</span>

<span class="err">#</span><span class="x"> export the display environment variable</span>
<span class="x">export DISPLAY=:0</span>
</pre>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../spark-scala-sheffield-hpc/" rel="prev" title="Spark and Scala on Sheffield HPC systems">Previous post</a>
            </li>
            <li class="next">
                <a href="../coffee-and-cakes-event-2nd/" rel="next" title="Coffee and Cakes Event">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents Â© 2017         <a href="mailto:rse@sheffield.ac.uk">Mike Croucher and Paul Richmond</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
