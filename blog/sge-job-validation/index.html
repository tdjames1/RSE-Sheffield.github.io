<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Job validation with Grid Engine | RSE at Sheffield</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://rse.shef.ac.uk/blog/sge-job-validation/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Will Furnass">
<link rel="prev" href="../icms-2017/" title="Computational Mathematics with Jupyter workshop" type="text/html">
<link rel="next" href="../mpi_placement/" title="Determining MPI placement on the HPC clusters" type="text/html">
<meta property="og:site_name" content="RSE at Sheffield">
<meta property="og:title" content="Job validation with Grid Engine">
<meta property="og:url" content="http://rse.shef.ac.uk/blog/sge-job-validation/">
<meta property="og:description" content="Computer cluster job scheduling software is fantastic at managing resources 
and permitting many jobs to run efficiently and simultaneously.
However, schedulers aren't always great at giving end-users">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-03-20T10:44:00Z">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://rse.shef.ac.uk/">

                <span id="blog-title">RSE at Sheffield</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../activities">What we do</a>
                </li>
<li>
<a href="../../training">Training</a>
                </li>
<li>
<a href="../../blog">Blog</a>
                </li>
<li>
<a href="../../community">Community</a>
                </li>
<li>
<a href="../../resources">Resources</a>
                </li>
<li>
<a href="../../forged">Forged in Sheffield</a>
                </li>
<li>
<a href="../../testimonials">Testimonials</a>
                </li>
<li>
<a href="../../contact">Contact Us</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Job validation with Grid Engine</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/will-furnass/">Will Furnass</a>
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-03-20T10:44:00Z" itemprop="datePublished" title="2017-03-20 10:44">2017-03-20 10:44</time></a></p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Computer cluster job scheduling software is fantastic at managing resources 
and permitting many jobs to run efficiently and simultaneously.<br>
However, schedulers aren't always great at giving end-users feedback 
when things go wrong.  </p>
<p>For example, on our ShARC cluster, which runs the (Son of) Grid Engine (SGE) scheduler, 
if you request a longer run-time than is permitted by any of the cluster's job queue configurations 
then your job will sit there queueing indefinitely until you or someone else deletes it.<br>
For example, let's use <a href="http://docs.hpc.shef.ac.uk/en/latest/hpc/scheduler/sge.html#running-batch-jobs-on-iceberg">qsub</a> 
to submit a job where we ask for 1000 hours of run time and 4 GiB of RAM:</p>
<pre class="code literal-block"><span></span><span class="o">[</span>will@mysofa ~<span class="o">]</span>$ ssh sharc
...
<span class="o">[</span>cs1wf@sharc-login1 ~<span class="o">]</span>$ qsub -l <span class="nv">h_rt</span><span class="o">=</span><span class="m">1000</span>:00:00 -l <span class="nv">rmem</span><span class="o">=</span>4G -m bea -M w.furnass@sheffield.ac.uk -N longtask myjobscript.sge

Your job <span class="m">236268</span> <span class="o">(</span><span class="s2">"STDIN"</span><span class="o">)</span> has been submitted
<span class="o">[</span>cs1wf@sharc-login1 ~<span class="o">]</span>$ qstat -u <span class="nv">$USER</span>
job-ID  prior   name       user         state submit/start at     queue                          slots ja-task-ID 
-----------------------------------------------------------------------------------------------------------------
 <span class="m">217834</span> <span class="m">0</span>.00000 longtask   cs1wf        qw    <span class="m">03</span>/20/2017 <span class="m">10</span>:48:39                                    <span class="m">1</span>        
</pre>


<p>Job 217834 will now sit queuing forever.<br>
Not only will you not be told why, 
you won't be given <em>any</em> notification that the job will not run.</p>
<p>In situations like this it can be useful to ask the scheduler to validate a job.<br>
One way of doing this is to run '<code>qalter -w v &lt;myjobid&gt;</code>' after job submission 
if say you think that a job has now been queueing for longer 
than previously-submitted jobs of a similar nature:</p>
<pre class="code literal-block"><span></span>[cs1wf@sharc-login1 ~]$ qalter -w v 217834
Job 217834 (-l h_rt=3600000) cannot run in queue "flybrain.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "gpu.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "gen2reg.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "rse.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "gpu-vis.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "insigneo-polaris.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "interactive.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "shortint.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "all.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "evolgen.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "rse-training.q" because of cluster queue
Job 217834 (-l h_rt=3600000) cannot run in queue "cstest.q" because of cluster queue
verification: no suitable queues
</pre>


<p>What this '<code>qalter -w v &lt;myjobid&gt;</code>' command does is check to see whether the job could run 
in any of the job queues on the cluster 
if the cluster were free of other jobs. </p>
<p>The last line of output is key: 
our job will never be run given the current cluster configuration.<br>
Looking above that, we can see that it cannot run in any of the general-purpose job queues 
(such as <code>all.q</code>) and 
there is specific mention of our 1000 hour (3600000s) run-time resource request.<br>
We can therefore deduce that our run-time resource request wasn't satisfiable.</p>
<h3>Modifying a resource request post-submission</h3>
<p>Once we know that our job can't run we could then delete our job...</p>
<pre class="code literal-block"><span></span><span class="o">[</span>cs1wf@sharc-login1 ~<span class="o">]</span>$ qdel <span class="m">217834</span> 
cs1wf has deleted job <span class="m">217834</span> 
</pre>


<p>...then consult the cluster's documentation to discover the maximum possible run-time and resubmit using more sensible resource requests.  </p>
<p>Alternatively we can use <strong>qalter</strong> to modify the resource requests associated with a queueing job:</p>
<pre class="code literal-block"><span></span>qalter -l <span class="nv">h_rt</span><span class="o">=</span><span class="m">96</span>:00:00 -l <span class="nv">rmem</span><span class="o">=</span>4G <span class="m">217834</span> 
</pre>


<p><strong>Important</strong>: using <code>qalter</code> in this fashion will change <strong>all</strong> resource requests for the job so here we need to re-specify the <code>rmem</code> request.</p>
<h3>Job validation at submission time</h3>
<p>You can also perform the same type of job validation <strong>at job submission time</strong> using <code>-w v</code> e.g.</p>
<pre class="code literal-block"><span></span>qsub -w v -l <span class="m">1000</span>:00:00 -l <span class="nv">rmem</span><span class="o">=</span>4G myjobscript.sge
</pre>


<p>This won't actually submit your job; it just performs validation.</p>
<h3>Why is validation not performed by default?</h3>
<p>You may ask why such validation is not enabled by default for all jobs; 
one reason for this is that it is believed it would place undue burden on the scheduler.</p>
<p>Another is that sometimes a validation attempt results in a false negative that can be difficult to automatically identify.</p>
<h3>Other types of resources</h3>
<p>If you repeat the experiment outlined above but 
instead of requesting 1000 hours of runtime 
you ask for 100 GPUs, 9999GB of RAM or 10000 cores 
you'll observe the same behaviour: jobs that make requests unsatisfiable under the current cluster configuration can be submitted but will never run.</p>
<p>Again, job validation can help here but depending on the type of resource the validation error messages can be more or less cryptic.<br>
For example, if you try to validate a 100000-'slot' (core) MPI job using <code>-w v</code> you get the following:</p>
<pre class="code literal-block"><span></span>qsub -pe mpi 100000 -w v somejob.sge
...
Job 311838 cannot run in PE "mpi" because it only offers 0 slots
</pre>


<p>This is rather misleading but the mention of 'slots' should prompt you to check the number of cores you've requested is sensible.</p>
<h3>'Poke' validation: consider the current cluster load</h3>
<p>Another type of validation is <em>poke</em> validation, 
which checks if a job could be run under the current cluster <em>load</em> 
i.e. with many of the cluster's resources already in use.<br>
See <code>man qsub</code> and search for <code>-w</code> 
for more information on the different types of validation.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../icms-2017/" rel="prev" title="Computational Mathematics with Jupyter workshop">Previous post</a>
            </li>
            <li class="next">
                <a href="../mpi_placement/" rel="next" title="Determining MPI placement on the HPC clusters">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents Â© 2017         <a href="mailto:rse@sheffield.ac.uk">Mike Croucher and Paul Richmond</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
